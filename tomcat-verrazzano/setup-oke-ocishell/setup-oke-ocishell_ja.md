# Oracle Cloud InfrastructureでのOracle Kubernetes Engineインスタンスの設定

## 概要

このラボでは、Oracle Cloud Infrastructureで管理対象Kubernetes環境を作成するステップについて説明します。

見積時間: 15分

### 製品・技術について

Oracle Cloud Infrastructure Container Engine for Kubernetesは、コンテナ・アプリケーションをクラウドにデプロイするために使用できる、完全に管理されたスケーラブルで可用性の高いサービスです。開発チームがクラウドネイティブ・アプリケーションを確実に構築、導入、管理したい場合は、Container Engine for Kubernetes(OKEと略されることもあります)を使用します。アプリケーションに必要なコンピュート・リソースを指定すると、OKEは既存のOCIテナンシでOracle Cloud Infrastructureにそれらをプロビジョニングします。

### 目的

この演習では、次のことを行います。

*   OKE (Oracle Kubernetes Engine)インスタンスを作成します。
*   OCI Cloud Shellを開き、`kubectl`を構成してKubernetesクラスタと対話します。

### 前提条件

*   [Oracle Cloud Infrastructure](https://cloud.oracle.com/en_US/cloud-infrastructure)が有効になっているアカウントが必要です。

Container Engine for Kubernetes (OKE)を作成するには、次のステップを実行します:

*   ネットワーク・リソース(VCN、サブネット、セキュリティ・リストなど)を作成します。
*   クラスタを作成します。
*   `NodePool`を作成します。

このラボでは、_クイック・スタート_機能によって、3ノードのKubernetesクラスタに必要なすべてのリソースがどのように作成および構成されるかを示します。高可用性を確保するために、すべてのノードが異なる可用性ドメインにデプロイされます。

OKEおよびカスタム・クラスタ・デプロイメントの詳細は、[Oracle Container Engine](https://docs.cloud.oracle.com/iaas/Content/ContEng/Concepts/contengoverview.htm)のドキュメントを参照してください。

## タスク1: OKEクラスタの作成

_クイック作成_機能では、デフォルト設定を使用して、必要に応じて新しいネットワーク・リソースを含む_クイック・クラスタ_を作成します。このアプローチは、新しいクラスタを作成する最速の方法です。すべてのデフォルト値を受け入れると、わずか数回のクリックで新しいクラスタを作成できます。クラスタの新しいネットワーク・リソースは、ノード・プールおよび3つのワーカー・ノードとともに自動的に作成されます。

1.  コンソールで、次に示すように_「ハンバーガー・メニュー」→「開発者サービス」→「Kubernetesクラスタ(OKE)」_を選択します。
    
    ![ハンバーガ・メニュー](images/hamburger-menu.png " ")
    
2.  「クラスタ・リスト」ページで、クラスタの作成を許可する任意のコンパートメントを選択し、_「クラスタの作成」_をクリックします。
    
    > クラスタの作成が許可されているコンパートメントと、Oracle Container Registry内のリポジトリを選択する必要があります。
    
    ![コンパートメントの選択](images/select-compartment.png " ")
    
3.  「クラスタ・ソリューションの作成」ダイアログで、_「クイック作成」_を選択して_「送信」_をクリックします。
    
    ![ワークフローの起動](images/launch-workflow.png " ")
    
    _クイック作成_では、新しいクラスタの新しいネットワーク・リソースとともに、デフォルト設定を使用して新しいクラスタが作成されます。
    
    クラスタ作成ページで次の構成詳細を指定します(_「シェイプ」_フィールドに配置した値に注意してください)。
    
    *   **名前**: クラスタの名前。デフォルト値のままにします。
    *   **コンパートメント**: コンパートメントの名前。リソースの作成を許可するコンパートメントを選択します。
    *   **Kubernetesバージョン**: Kubernetesのバージョン。Kubernetesバージョンとして_1.26.2_を選択します。
    *   **Kubernetes APIエンドポイント**: クラスタ・マスター・ノードがルーティング可能かどうか。_「パブリック・エンドポイント」_値を選択します。
    *   **ノード・タイプ**: ノード・タイプとして_「管理対象」_を選択します。
    *   **Kubernetesワーカー・ノード**: クラスタ・ワーカー・ノードがルーティング可能かどうか。デフォルトの_「非公開就業者」_値のままにします。
    *   **シェイプ**: ノード・プールの各ノードに使用するシェイプ。シェイプによって、CPUの数および各ノードに割り当てられるメモリー量が決まります。リストには、OKEでサポートされているテナンシで使用可能なシェイプのみが表示されます。_VM.Standard.E4を選択します。フレックス_(通常はOracle Free Tierアカウントで使用できます)。メモリー量として2 OCPUおよび32 GBを選択します。
    *   **イメージ**: Kubernetesバージョン_1.26.2_のデフォルト・イメージを選択します。
    *   **ノード数**: 作成するワーカー・ノードの数。デフォルト値は_3_のままにします。
    
    > _デフォルトのシェイプを残さないように注意してください。デフォルトのシェイプが小さすぎてすべてのVERRAZZANOコンポーネントに適合しません_
    
    ![クイック・クラスタ](images/quick-cluster.png " ") ![ノード番号](images/node-number.png " ")
    
4.  _「次」_をクリックして、新しいクラスタ用に入力した詳細を確認します。
    
5.  _「確認」_ページで、_「基本クラスタの作成」_のチェック・ボックスを選択し、_「クラスタの作成」_をクリックして、新しいネットワーク・リソースおよび新しいクラスタを作成します。
    
    ![クラスタのレビュー](images/review-cluster.png " ")
    
    > 作成したネットワーク・リソースが表示されます。ノード・プールを作成するリクエストが開始されるまで待機してから、_「閉じる」_をクリックします。
    
    ![ネットワーク・リソース](images/network-resource.png " ")
    
    > 次に、新しいクラスタが_「クラスタの詳細」_ページに表示されます。マスター・ノードが作成されると、新しいクラスタのステータスは_「アクティブ」_になります(約7分かかります)。そうすれば、研究室を続けることができます。
    
    ![クラスタ・プロビジョニング](images/cluster-provision.png " ")
    
    ![クラスタ・アクセス](images/cluster-access.png " ")
    

## タスク2: `kubectl`の構成(KubernetesクラスタCLI)

Oracle Cloud Infrastructure (OCI)のCloud Shellは、Oracle CloudコンソールからアクセスできるWebブラウザベースのターミナルです。クラウド・シェルは、事前認証済のOracle Cloud Infrastructure CLIおよびその他の有用なツール(_Git、kubectl、helm、OCI CLI_)を使用してLinuxシェルにアクセスし、Verrazzanoチュートリアルを完了します。クラウド・シェルにはコンソールからアクセスできます。クラウド・シェルは、コンソールの永続フレームとしてOracle Cloudコンソールに表示され、コンソールの別のページに移動してもアクティブなままになります。

_クラウド・シェル_を使用して、このワークショップを完了します。

`kubectl`を使用して、クラウド・シェルを使用してクラスタをリモートで管理します。`kubeconfig`ファイルが必要です。これは事前認証済のOCI CLIを使用して生成されるため、使用を開始する前に行う設定はありません。

1.  クラスタの詳細ページで_「クラスタへのアクセス」_をクリックします。
    
    > そのページから移動した場合は、ナビゲーション・メニューを開き、_「開発者サービス」_で_「Kubernetesクラスタ(OKE)」_を選択します。クラスタを選択し、詳細ページに移動します。
    
    ![クラスタへのアクセス](images/access-cluster.png " ")
    
    > Kubernetes構成ファイルを作成するために、クラウド・シェルを開くことができるダイアログが表示され、実行する必要があるカスタマイズされたOCIコマンドが含まれています。
    
2.  デフォルトの_クラウド・シェル・アクセス_のままにして、最初に_「コピー」_リンクを選択し、`oci ce...`コマンドをクラウド・シェルにコピーします。
    
    ![kubectl構成のコピー](images/copy-config.png " ")
    
3.  ここで、_「クラウド・シェルの起動」_をクリックして、組込みコンソールを開きます。次に、コマンドを_クラウド・シェル_に貼り付ける前に構成ダイアログを閉じます。
    
    ![Cloud Shellの起動](images/launch-cloudshell.png " ")
    
4.  クリップボードからコマンド(Ctrl+Vまたは右クリックしてコピー)をクラウド・シェルにコピーし、コマンドを実行します。
    
    たとえば、コマンドは次のようになります。
    
        oci ce cluster create-kubeconfig --cluster-id ocid1.cluster.oc1.phx.aaaaaaaaaezwen..................zjwgm2tqnjvgc2dey3emnsd --file $HOME/.kube/config --region us-phoenix-1 --token-version 2.0.0
        
    
    ![kubectl構成](images/kube-config.png " ")
    
5.  `get node`コマンドなどを使用して、`kubectl`が機能していることを確認します。次のような出力が表示されるまで、このコマンドを複数回実行する必要がある場合があります。
    
        <copy>kubectl get node</copy>
        
    
        $ kubectl get node
        NAME          STATUS   ROLES   AGE   VERSION
        10.0.10.101   Ready    node    11m   v1.26.2
        10.0.10.29    Ready    node    11m   v1.26.2
        10.0.10.37    Ready    node    11m   v1.26.2
        
    
    > ノードの情報が表示された場合、構成は成功しました。
    
6.  クラウド・シェルの右上隅にあるコントロールを使用して、いつでも端末サイズを最小化およびリストアできます。
    
    ![クラウド・シェル](images/cloudshell.png " ")
    

この_クラウド・シェル_は開いたままにしておきます。以降の演習に使用します。

## 確認

*   **著者** - Ankit Pandey
*   **貢献者** - Sid Joshi、Maciej Gruszka
*   **最終更新者/日付** - Ankit Pandey、2023年8月